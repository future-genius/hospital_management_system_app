{% extends 'base.html' %}

{% block title %}Patient Dashboard - Clinical Facility Network{% endblock %}

{% block content %}
<div class="container py-4">

  <h1 class="h3 fw-bold text-navy mb-4">Patient Dashboard</h1>

  <!-- Upcoming Appointments -->
  <div class="mb-5">
    <h5 class="fw-semibold mb-3">Upcoming Appointments</h5>
    {% if upcoming %}
      <div class="card shadow-sm">
        <div class="card-body p-0">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Doctor</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for a in upcoming %}
              <tr>
                <td>{{ a.appointment_date }}</td>
                <td>{{ a.appointment_time }}</td>
                <td>{{ a.doctor.account.full_name }}</td>
                <td>
                  <span class="badge {% if a.status == 'scheduled' %}bg-primary{% elif a.status == 'completed' %}bg-success{% else %}bg-secondary{% endif %}">
                    {{ a.status|capitalize }}
                  </span>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    {% else %}
      <div class="text-center py-4 text-muted">No upcoming appointments</div>
    {% endif %}
  </div>

  <!-- Recent Visits -->
  <div>
    <h5 class="fw-semibold mb-3">Recent Visits</h5>
    {% if completed %}
      <div class="list-group">
        {% for a in completed %}
        <div class="list-group-item d-flex justify-content-between align-items-start">
          <div>
            <strong>{{ a.appointment_date }}</strong> with {{ a.doctor.account.full_name }}
            <div class="text-muted small mt-1">{{ a.treatment_record.diagnosis if a.treatment_record else 'No record available' }}</div>
          </div>
          <span class="badge bg-light text-dark rounded-pill">{{ a.status|capitalize }}</span>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-4 text-muted">No recent visits</div>
    {% endif %}
  </div>

</div>
{% endblock %}
