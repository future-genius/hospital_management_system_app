{% extends "base.html" %}

{% block title %}Edit Doctor - Clinical Facility Network{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- Header -->
  <div class="d-flex align-items-center gap-2 mb-4">
    <a href="{{ url_for('governance.list_providers') }}" class="btn btn-sm btn-outline-secondary">
      <i class="fas fa-arrow-left me-1"></i> Back to Doctors
    </a>
    <h1 class="h3 fw-bold text-navy mb-0">Edit Doctor Details</h1>
  </div>

  <!-- Edit Form -->
  <div class="card shadow-sm" style="max-width: 600px;">
    <div class="card-header bg-light">
      <h5 class="card-title mb-0">
        <i class="fas fa-user-md me-2"></i> {{ provider.account_link.full_name }}
      </h5>
      {% if provider.doctor_unique_id %}
      <small class="text-muted d-block mt-2">ID: {{ provider.doctor_unique_id }}</small>
      {% endif %}
    </div>
    <div class="card-body">
      <form method="POST">
        <!-- Given Name -->
        <div class="mb-3">
          <label for="given_name" class="form-label fw-semibold">First Name</label>
          <input 
            type="text" 
            class="form-control" 
            id="given_name" 
            name="given_name"
            value="{{ provider.account_link.given_name or '' }}"
            required
          >
        </div>

        <!-- Surname -->
        <div class="mb-3">
          <label for="surname" class="form-label fw-semibold">Last Name</label>
          <input 
            type="text" 
            class="form-control" 
            id="surname" 
            name="surname"
            value="{{ provider.account_link.surname or '' }}"
            required
          >
        </div>

        <!-- Email -->
        <div class="mb-3">
          <label for="email_address" class="form-label fw-semibold">Email Address</label>
          <input 
            type="email" 
            class="form-control" 
            id="email_address" 
            name="email_address"
            value="{{ provider.account_link.email_address or '' }}"
            required
          >
        </div>

        <!-- Clinic / Department -->
        <div class="mb-3">
          <label for="clinic_id" class="form-label fw-semibold">Department</label>
          <select class="form-select" id="clinic_id" name="clinic_id" required>
            <option value="">-- Select Department --</option>
            {% for clinic in clinics %}
            <option value="{{ clinic.clinic_id }}" {% if provider.clinic_id == clinic.clinic_id %}selected{% endif %}>
              {{ clinic.clinic_title }}
            </option>
            {% endfor %}
          </select>
        </div>

        <!-- Expertise / Specialization -->
        <div class="mb-3">
          <label for="expertise" class="form-label fw-semibold">Specialization</label>
          <input 
            type="text" 
            class="form-control" 
            id="expertise" 
            name="expertise"
            placeholder="e.g., Cardiology, Surgery"
            value="{{ provider.expertise or '' }}"
          >
        </div>

        <!-- Action Buttons -->
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-1"></i> Save Changes
          </button>
          <a href="{{ url_for('governance.list_providers') }}" class="btn btn-secondary">
            <i class="fas fa-times me-1"></i> Cancel
          </a>
        </div>
      </form>
    </div>
  </div>

  <!-- Danger Zone -->
  <div class="card shadow-sm border-danger mt-4" style="max-width: 600px;">
    <div class="card-header bg-danger text-white">
      <h5 class="card-title mb-0">
        <i class="fas fa-exclamation-triangle me-2"></i> Danger Zone
      </h5>
    </div>
    <div class="card-body">
      <p class="text-muted mb-3">
        Deleting this doctor will remove all their data and associated appointments from the system.
      </p>
      <form method="POST" action="{{ url_for('governance.delete_provider', provider_id=provider.provider_id) }}" 
            onsubmit="return confirm('Are you sure you want to permanently delete {{ provider.account_link.full_name }}? This action cannot be undone.');">
        <button type="submit" class="btn btn-danger">
          <i class="fas fa-trash me-1"></i> Delete Doctor
        </button>
      </form>
    </div>
  </div>

</div>
{% endblock %}
