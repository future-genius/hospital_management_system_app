{% extends "base.html" %}

{% block title %}Session Records - Clinical Facility Network{% endblock %}

{% block content %}
<div class="page-content">

  <!-- Header with Action Button -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
    <div>
      <h1 style="font-size: 2rem; font-weight: 800; color: var(--navy); margin-bottom: 0.3rem;">
        <i class="fas fa-calendar-alt" style="color: var(--primary-main); margin-right: 0.7rem;"></i>All Appointments
      </h1>
      <p style="color: var(--gray-600); margin-bottom: 0;">Manage all healthcare appointments in the system</p>
    </div>
    <a href="{{ url_for('governance.create_session') }}" class="btn btn-primary" style="padding: 0.85rem 1.8rem; font-weight: 700; text-decoration: none; border-radius: var(--radius-lg); transition: var(--transition); white-space: nowrap;"
       onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-lg)';"
       onmouseout="this.style.transform='none'; this.style.boxShadow='var(--shadow-md)';">
      <i class="fas fa-plus"></i> Register Appointment
    </a>
  </div>

  {% if sessions %}
    <div class="card" style="box-shadow: var(--shadow-lg); border: none;">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead style="background: linear-gradient(135deg, var(--primary-main), var(--primary-light)); color: white;">
              <tr>
                <th style="padding: 1rem; font-weight: 700;">Appointment Code</th>
                <th style="padding: 1rem; font-weight: 700;">Date & Time</th>
                <th style="padding: 1rem; font-weight: 700;">Patient ID</th>
                <th style="padding: 1rem; font-weight: 700;">Provider ID</th>
                <th style="padding: 1rem; font-weight: 700;">Status</th>
                <th style="padding: 1rem; font-weight: 700; text-align: center;">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for session in sessions %}
              <tr style="border-bottom: 1px solid var(--gray-200); transition: var(--transition);" onmouseover="this.style.backgroundColor='var(--gray-50)'" onmouseout="this.style.backgroundColor='transparent'">
                <td style="padding: 1rem; color: var(--navy); font-weight: 700; font-family: monospace;">
                  <i class="fas fa-ticket-alt" style="color: var(--primary-main); margin-right: 0.3rem;"></i>{{ session.unique_appointment_code or 'N/A' }}
                </td>
                <td style="padding: 1rem; color: var(--gray-700);">
                  <i class="fas fa-calendar" style="color: var(--primary-main); margin-right: 0.5rem;"></i>{{ session.booked_timestamp.strftime('%b %d, %Y at %H:%M') }}
                </td>
                <td style="padding: 1rem; color: var(--gray-700);">
                  <i class="fas fa-user" style="color: var(--primary-main); margin-right: 0.3rem;"></i>#{{ session.recipient_id }}
                </td>
                <td style="padding: 1rem; color: var(--gray-700);">
                  <i class="fas fa-user-md" style="color: var(--primary-main); margin-right: 0.3rem;"></i>#{{ session.provider_id }}
                </td>
                <td style="padding: 1rem;">
                  {% set state = session.session_state %}
                  <span class="appointment-badge 
                    {% if state == 'scheduled' %}badge-scheduled
                    {% elif state == 'completed' %}badge-completed
                    {% else %}badge-pending{% endif %}">
                    {{ state|capitalize }}
                  </span>
                </td>
                <td style="padding: 1rem; text-align: center;">
                  <a href="#" class="btn btn-sm btn-primary" style="text-decoration: none; padding: 0.5rem 1rem; margin-right: 0.5rem;">
                    <i class="fas fa-eye"></i> View
                  </a>
                  <form method="POST" action="{{ url_for('governance.delete_session', session_id=session.session_id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this appointment? This action cannot be undone.');">
                    <button type="submit" class="btn btn-sm btn-danger" style="text-decoration: none; padding: 0.5rem 1rem;">
                      <i class="fas fa-trash"></i> Delete
                    </button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% else %}
    <div class="empty-state">
      <i class="fas fa-inbox"></i>
      <h3 class="empty-state-title">No Appointments Found</h3>
      <p class="empty-state-desc">There are currently no appointments in the system.</p>
      <a href="{{ url_for('governance.create_session') }}" class="btn btn-primary" style="text-decoration: none;">
        <i class="fas fa-plus"></i> Create First Appointment
      </a>
    </div>
  {% endif %}

</div>
{% endblock %}
